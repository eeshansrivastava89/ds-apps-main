---
import SubstackPostPreview from '../../../packages/shared/src/components/SubstackPostPreview.astro'
import PageLayout from '@/layouts/BaseLayout.astro'
import { getSubstackPosts } from '../../../packages/shared/src/lib/substack'
import { siteConfig } from '@/site-config'
import Breadcrumbs from '../../../packages/shared/src/components/Breadcrumbs.astro'

// Import YAML mapping as raw text
import substackMappingsRaw from '../../../packages/shared/src/data/substack-posts.yaml?raw'

// Fetch Substack posts
const substackPosts = await getSubstackPosts(siteConfig.substackRssUrl, substackMappingsRaw)

// Sort by date (newest first)
const sortedPosts = substackPosts.sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime())

const meta = {
	description: 'Behind-the-scenes of building data science apps. What I\'m learning, what the data shows, and what I decide to ship.',
	title: 'Writing'
}
---

<PageLayout meta={meta}>
	<div class='w-full'>
		<Breadcrumbs />

		<h1 class='mb-2 mt-5 text-2xl font-bold'>Writing</h1>
		<p class='mb-8 text-base text-muted-foreground'>Behind-the-scenes of building data science apps. What I'm learning, what the data shows, and what I decide to ship.</p>

		{sortedPosts.length > 0 ? (
			<ul class='flex flex-col gap-y-4 list-none p-0 m-0'>
				{sortedPosts.map((post) => (
					<SubstackPostPreview post={post} withDesc />
				))}
			</ul>
		) : (
			<p>No posts yet.</p>
		)}
	</div>
</PageLayout>
