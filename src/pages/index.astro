---
import PageLayout from '../layouts/BaseLayout.astro'
import Card from '../components/Card.astro'
import FormattedDate from '../components/FormattedDate.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import { getAllPosts, sortMDByDate, getUniqueTagsWithCount } from '../utils'
import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(
	path.join(process.cwd(), 'src/data/social-links.yaml'),
	'utf8'
)
const socialData = yaml.load(socialLinksYaml) as {
	socialLinks: Array<{ name: string; url: string; icon: string; label: string }>
}
const socialLinks = socialData.socialLinks

// Load posts
const allPosts = await getAllPosts()
const sortedPosts = sortMDByDate(allPosts)
const recentPost = sortedPosts[0]
const tags = getUniqueTagsWithCount(sortedPosts)
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='flex w-full flex-col gap-y-12'>
		<!-- Hero Section -->
		<section class='flex flex-col items-center gap-y-6 text-center'>
			<!-- Profile Image -->
			<Image
				src={profile}
				alt='profile photo'
				class='rounded-full bg-[#FFBE98] p-2'
				style='height: 200px; width: auto;'
				loading='eager'
			/>

			<!-- Name -->
			<h1 class='text-4xl font-bold'>Eeshan S.</h1>

			<!-- Subtitle -->
			<p class='max-w-lg text-lg text-muted-foreground'>
				Data science leader who likes to write, build and teach
			</p>

			<!-- Social Links Icons Row -->
			<div class='flex gap-x-4'>
				{
					socialLinks.map((link) => (
						<a
							href={link.url}
							target='_blank'
							class='flex h-10 w-10 items-center justify-center rounded-full border border-border bg-primary-foreground transition-all hover:bg-input'
							aria-label={link.label}
						>
							<Icon name={link.icon} class='h-5 w-5' />
						</a>
					))
				}
			</div>

			<!-- Utility Section: Two Column Layout -->
			<div
				class='grid w-full grid-cols-1 gap-4 rounded-xl border border-orange-200 md:grid-cols-2 md:gap-0'
			>
				<!-- Left Column: Substack CTA -->
				<a
					href='https://scienceofexperimentation.substack.com'
					target='_blank'
					class='group flex items-center rounded-xl bg-orange-50 px-6 py-4 transition-all duration-200 hover:border-orange-300 hover:bg-orange-100 hover:shadow-md md:rounded-r-none md:border-r-0'
				>
					<div class='flex-1'>
						<div class='mb-2 flex items-center gap-x-3'>
							<div class='flex-shrink-0 rounded-lg bg-orange-500 p-2'>
								<Icon name='simple-icons:substack' class='h-5 w-5 text-white' />
							</div>
							<span class='text-xs font-semibold uppercase tracking-wider text-orange-600'
								>Newsletter</span
							>
						</div>
						<div class='text-left'>
							<p class='text-base font-bold leading-tight text-gray-900'>
								Science of Experimentation & Analytics
							</p>
							<p class='mt-0.5 text-sm leading-tight text-gray-600'>Subscribe to my newsletter</p>
						</div>
					</div>
					<div class='ml-4 flex flex-shrink-0 items-center gap-x-2'>
						<svg
							class='h-4 w-4 text-orange-600 transition-transform duration-200 group-hover:translate-x-1'
							fill='none'
							stroke='currentColor'
							viewBox='0 0 24 24'
							><path
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M9 5l7 7-7 7'></path></svg
						>
					</div>
				</a>

				<!-- Right Column: Two Stacked Utilities -->
				<div class='flex flex-col border-orange-200 md:border-l'>
					<!-- Top: A/B Simulator -->
					<a
						href='/ab-simulator'
						class='group flex items-center justify-between rounded-xl border border-border bg-primary-foreground px-6 py-4 transition-all duration-200 hover:border-foreground/50 hover:bg-input hover:shadow-sm md:rounded-none md:rounded-tr-xl md:border-b md:border-l-0 md:border-t-0'
					>
						<div class='flex items-center gap-x-3'>
							<div class='flex-shrink-0 rounded-lg bg-blue-500 p-2'>
								<Icon name='simple-icons:flask' class='h-5 w-5 text-white' />
							</div>
							<div class='text-left'>
								<p class='text-sm font-semibold text-foreground'>A/B Test Simulator</p>
								<p class='text-xs text-muted-foreground'>Interactive experiments</p>
							</div>
						</div>
						<svg
							class='h-4 w-4 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1'
							fill='none'
							stroke='currentColor'
							viewBox='0 0 24 24'
							><path
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M9 5l7 7-7 7'></path></svg
						>
					</a>

					<!-- Bottom: Browse Projects -->
					<a
						href='/projects'
						class='group flex items-center justify-between rounded-xl border border-border bg-primary-foreground px-6 py-4 transition-all duration-200 hover:border-foreground/50 hover:bg-input hover:shadow-sm md:rounded-none md:rounded-br-xl md:border-l-0 md:border-t-0'
					>
						<div class='flex items-center gap-x-3'>
							<div class='flex-shrink-0 rounded-lg bg-purple-500 p-2'>
								<Icon name='simple-icons:github' class='h-5 w-5 text-white' />
							</div>
							<div class='text-left'>
								<p class='text-sm font-semibold text-foreground'>Browse Projects</p>
								<p class='text-xs text-muted-foreground'>See what I've built</p>
							</div>
						</div>
						<svg
							class='h-4 w-4 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1'
							fill='none'
							stroke='currentColor'
							viewBox='0 0 24 24'
							><path
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M9 5l7 7-7 7'></path></svg
						>
					</a>
				</div>
			</div>
		</section>

		<!-- Recent Post Section -->
		{
			recentPost ? (
				<section class='flex flex-col gap-y-4'>
					<h2 class='text-2xl font-bold'>Latest Post</h2>
					<a href={`/blog/${recentPost.slug}`} class='group'>
						<div class='rounded-lg border border-border bg-primary-foreground p-4 transition-all hover:border-foreground/50 hover:shadow-sm'>
							<h3 class='text-lg font-semibold group-hover:text-foreground/75'>
								{recentPost.data.title}
							</h3>
							<p class='mt-2 text-sm text-muted-foreground'>{recentPost.data.description}</p>
							<div class='mt-3 flex items-center justify-between'>
								<FormattedDate date={recentPost.data.publishDate} />
							</div>
						</div>
					</a>
				</section>
			) : null
		}

		<!-- Tags Section -->
		{
			tags.length > 0 ? (
				<section class='flex flex-col gap-y-4'>
					<h2 class='text-2xl font-bold'>Explore by Topic</h2>
					<div class='flex flex-wrap gap-2'>
						{tags.map(([tag, count]) => (
							<a
								href={`/tags/${tag}`}
								class='rounded-lg border border-border bg-primary-foreground px-3 py-1.5 text-sm transition-all hover:border-foreground/50 hover:bg-input'
							>
								<span class='font-medium'>#{tag}</span>
								<span class='ml-1 text-xs text-muted-foreground'>({count})</span>
							</a>
						))}
					</div>
				</section>
			) : null
		}
	</div>
</PageLayout>
