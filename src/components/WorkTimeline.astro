---
/**
 * Work Experience Timeline (Left-Accent Style)
 * Vertical line with dots, expand on hover
 */

interface TimelineItem {
  timespan: string
  title: string
  company?: string
  description?: string
  logo?: string
  details?: string[]
  type?: 'education' | 'work'
}

interface Props {
  items: TimelineItem[]
}

const { items } = Astro.props
---

<div class='relative'>
  {/* Vertical line */}
  <div class='absolute left-[7px] top-2 bottom-2 w-px bg-border' />

  <div class='space-y-1'>
    {items.map((item) => {
      const isCurrent = item.timespan.includes('Present')
      const isEducation = item.type === 'education'
      const hasContent = item.description || (item.details && item.details.length > 0)

      return (
        <div class='relative pl-7 group'>
          {/* Dot */}
          <div class={`absolute left-0 top-[10px] h-[15px] w-[15px] rounded-full border-2 transition-all
            ${isCurrent
              ? 'border-emerald-500 bg-emerald-500'
              : isEducation
                ? 'border-sky-400 bg-background group-hover:bg-sky-400'
                : 'border-muted-foreground/40 bg-background group-hover:bg-muted-foreground/40'
            }`}
          />

          <div class='py-2 hover:bg-muted/30 -ml-2 pl-2 pr-2 rounded transition-colors'>
            {/* Header row */}
            <div class='flex items-baseline justify-between gap-4'>
              <div class='flex-1 min-w-0'>
                <span class='text-base font-semibold text-foreground'>{item.title}</span>
                <span class='text-base text-muted-foreground'> · {item.company}</span>
              </div>
              <span class={`text-sm tabular-nums shrink-0 ${isCurrent ? 'text-emerald-600 dark:text-emerald-400 font-medium' : isEducation ? 'text-sky-600 dark:text-sky-400' : 'text-muted-foreground'}`}>
                {item.timespan}
              </span>
            </div>

            {/* Expanded Content - hidden by default, shown on hover */}
            {hasContent && (
              <div class='max-h-0 overflow-hidden opacity-0 group-hover:max-h-96 group-hover:opacity-100 transition-all duration-300 ease-in-out'>
                <div class='pt-2 pb-1'>
                  {item.description && (
                    <p class='text-sm text-muted-foreground leading-relaxed'>{item.description}</p>
                  )}
                  {item.details && item.details.length > 0 && (
                    <ul class='mt-2 space-y-1'>
                      {item.details.map((detail) => (
                        <li class='text-sm text-muted-foreground flex items-start gap-2'>
                          <span class='text-muted-foreground/40 mt-0.5'>—</span>
                          <span>{detail}</span>
                        </li>
                      ))}
                    </ul>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      )
    })}
  </div>
</div>
